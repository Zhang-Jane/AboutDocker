

### docker学习杂记 

* 学习地址：阮一峰个人博客：<http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html>

* docker是什么？能做什么？有什么优势？（摘录于博客）

  * Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux 容器解决方案。

    Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。

    总体来说，Docker 的接口相当简单，用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样

  * Docker 的主要用途，目前有三大类。

    （1）提供一次性的环境。比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。

    （2）提供弹性的云服务。因为 Docker 容器可以随开随关，很适合动态扩容和缩容。

    （3）组建微服务架构。通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。

  * 由于容器是进程级别的，相比虚拟机有很多优势。

    **（1）启动快**

    容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。

    **（2）资源占用少**

    容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。

    **（3）体积小**

    容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。

    总之，容器有点像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多

* 传统的虚拟机：

  * 虚拟机的缺点：

    * **（1）资源占用多**

      虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有 1MB，虚拟机依然需要几百 MB 的内存才能运行。

      **（2）冗余步骤多**

      虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。

      **（3）启动慢**

      启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用程序才能真正运行。

* centos下docker的安装文档：<https://docs.docker.com/install/linux/docker-ce/centos/>

* docker详解：

  * Docker 中有三个重要概念。

    * 镜像（Image）：
    
      * Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。镜像不包含任何动态数据，其内容在构建之后也不会被改变
    
    * 容器（Container）：
    
      * 镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的 类 和 实例 一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。
    
          容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 命名空间。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全
    
    *  仓库（Docker Registry）：
    
      * 镜像构建完成后，可以很容易的在当前宿主机上运行，但是，如果需要在其它服务器上使用这个镜像，我们就需要一个集中的存储、分发镜像的服务，Docker Registry 就是这样的服务。
    
      一个 Docker Registry 中可以包含多个 仓库（Repository）；每个仓库可以包含多个 标签（Tag）；每个标签对应一个镜像。
    
        通常，一个仓库会包含同一个软件不同版本的镜像，而标签就常用于对应该软件的各个版本。我们可以通过 <仓库名>:<标签> 的格式来指定具体是这个软件哪个版本的镜像。如果不给出标签，将以 latest 作为默认标签。
    
  * 制作docker容器：
  
    * Dockerfile: 类似于“package.json”
      |
      V
      Image: 类似于“W**in**7纯净版.rar”
      |
      V
      Container: 一个完整操作系统
  
  * 获取镜像：
  
    * 之前提到过，Docker Hub 上有大量的高质量的镜像可以用，这里我们就说一下怎么获取这些镜像。
  
      从 Docker 镜像仓库获取镜像的命令是 docker pull。其命令格式为：
  
      ```
      docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]
      ```
      
      
  
  * 列出镜像：
  
    * 要想列出已经下载下来的镜像，可以使用 docker image ls 命令
  
    * 通过以下命令来便捷的查看镜像、容器、数据卷所占用的空间：docker system df
  
    * 删除本地镜像：
  
      * 如果要删除本地的镜像，可以使用 `docker image rm` 命令，其格式为：
  
        ```bash
        $ docker image rm [选项] <镜像1> [<镜像2> ...]
        ```
  
        ```bash
        docker image ls
        ```
  
        ```bash
        docker image ls 默认列出的就已经是短 ID 了，一般取前3个字符以上，只要足够区分于别的镜像就可以了
        
        docker image rm 501
        ```
  
      * 我们需要删除所有仓库名为 `redis` 的镜像：
  
        ```bash
        $ docker image rm $(docker image ls -q redis)
        ```
  
      * 删除所有在 `mongo:3.2` 之前的镜像：
  
        ```bash
        $ docker image rm $(docker image ls -q -f before=mongo:3.2)
        ```
  
  * 使用 Dockerfile 定制镜像：
  
  <https://juejin.im/post/5d65e8aaf265da03970bca13>
  
  附docker入门地址：
  
  https://yeasy.gitbooks.io/docker_practice/introduction/what.html

